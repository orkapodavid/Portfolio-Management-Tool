<service>
  <id>reflex_service</id>
  <name>ReflexPMT Backend</name>
  <description>Runs the Reflex Python Backend (FastAPI).</description>
  <executable>%BASE%\.venv\Scripts\python.exe</executable>
  <argument>-m</argument>
  <argument>reflex</argument>
  <argument>run</argument>
  <argument>--env</argument>
  <argument>prod</argument>
  <argument>--backend-only</argument>
  <argument>--backend-port</argument>
  <argument>8000</argument>

  <env name="API_URL" value="https://hcma.ds.susq.com/pmt"/>
  <env name="CI" value="1"/>
  <env name="PMT_INTEGRATION_MODE" value="real"/>

  <!-- Log configuration with proper nested format -->
  <log mode="rotate">
    <logpath>%BASE%\logs</logpath>
    <sizeThreshold>10240</sizeThreshold>
    <keepFiles>5</keepFiles>
  </log>
  
  <!-- Service recovery options -->
  <onfailure action="restart" delay="10 sec"/>
  <onfailure action="restart" delay="20 sec"/>
  <onfailure action="restart" delay="60 sec"/>
  <resetfailure>1 hour</resetfailure>
  
  <!-- Dependencies - ensure network is available -->
  <depend>Tcpip</depend>
  
  <!-- Startup configuration -->
  <startmode>Automatic</startmode>
  <delayedAutoStart>true</delayedAutoStart>
</service>
